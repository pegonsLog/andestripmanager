<div class="dia-detail-container" *ngIf="dadosCompletos$ | async as dados">
    <!-- Loading spinner -->
    <div class="loading-container" *ngIf="isLoading$ | async">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Carregando detalhes do dia...</p>
    </div>

    <!-- Conteúdo principal -->
    <div class="content" *ngIf="(isLoading$ | async) === false && dados.dia">
        <!-- Cabeçalho do dia -->
        <mat-card class="header-card">
            <mat-card-header>
                <div mat-card-avatar class="dia-avatar">
                    <span class="dia-numero">{{ dados.dia.numeroDia }}</span>
                </div>

                <mat-card-title>
                    <div class="titulo-container">
                        <span class="data">{{ dados.dia.data | date:'dd/MM/yyyy' }}</span>
                        <div class="rota">
                            <span class="origem">{{ dados.dia.origem }}</span>
                            <mat-icon class="seta">arrow_forward</mat-icon>
                            <span class="destino">{{ dados.dia.destino }}</span>
                        </div>
                    </div>
                </mat-card-title>

                <mat-card-subtitle>
                    <div class="status-container">
                        <mat-chip-set>
                            <mat-chip [color]="dados.estatisticas?.isCompleto ? 'primary' : ''"
                                [class.completo]="dados.estatisticas?.isCompleto">
                                <mat-icon matChipAvatar>
                                    {{ dados.estatisticas?.isCompleto ? 'check_circle' : 'schedule' }}
                                </mat-icon>
                                {{ dados.estatisticas?.isCompleto ? 'Completo' : 'Planejado' }}
                            </mat-chip>
                        </mat-chip-set>
                    </div>
                </mat-card-subtitle>
            </mat-card-header>

            <!-- Estatísticas rápidas -->
            <mat-card-content>
                <div class="stats-grid">
                    <div class="stat-item">
                        <mat-icon>route</mat-icon>
                        <div class="stat-info">
                            <span class="stat-label">Distância</span>
                            <span class="stat-value">{{ formatarDistancia(dados.dia.distanciaPlanejada) }}</span>
                            <span *ngIf="dados.dia.distanciaPercorrida" class="stat-real">
                                ({{ formatarDistancia(dados.dia.distanciaPercorrida) }} percorridos)
                            </span>
                        </div>
                    </div>

                    <div class="stat-item" *ngIf="dados.dia.rota?.tempoEstimado">
                        <mat-icon>schedule</mat-icon>
                        <div class="stat-info">
                            <span class="stat-label">Tempo Estimado</span>
                            <span class="stat-value">{{ formatarTempo(dados.dia.rota!.tempoEstimado!) }}</span>
                            <span *ngIf="dados.dia.rota?.tempoReal" class="stat-real">
                                ({{ formatarTempo(dados.dia.rota!.tempoReal!) }} real)
                            </span>
                        </div>
                    </div>

                    <div class="stat-item">
                        <mat-icon>place</mat-icon>
                        <div class="stat-info">
                            <span class="stat-label">Paradas</span>
                            <span class="stat-value">{{ dados.estatisticas?.totalParadas || 0 }}</span>
                        </div>
                    </div>

                    <div class="stat-item" *ngIf="dados.estatisticas && dados.estatisticas.progresso && dados.estatisticas.progresso > 0">
                        <mat-icon>trending_up</mat-icon>
                        <div class="stat-info">
                            <span class="stat-label">Progresso</span>
                            <span class="stat-value">{{ dados.estatisticas.progresso.toFixed(0) }}%</span>
                        </div>
                    </div>
                </div>

                <!-- Barra de progresso -->
                <div class="progresso-container" *ngIf="dados.estatisticas && dados.estatisticas.progresso && dados.estatisticas.progresso > 0">
                    <div class="progresso-bar">
                        <div class="progresso-fill" [style.width.%]="dados.estatisticas.progresso"></div>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>

        <!-- Conteúdo do Mapa -->
        <div class="map-section">
            <mat-card class="map-card">
                <mat-card-header>
                    <mat-card-title>
                        <mat-icon>map</mat-icon>
                        Rota do Dia
                    </mat-card-title>
                    <mat-card-subtitle>
                        <div class="map-controls">
                            <button mat-icon-button 
                                    [class.active]="showTraffic"
                                    (click)="toggleTraffic()"
                                    matTooltip="Mostrar/Ocultar Trânsito">
                                <mat-icon>traffic</mat-icon>
                            </button>
                            <button mat-icon-button 
                                    [class.active]="showRestaurants"
                                    (click)="toggleRestaurants()"
                                    matTooltip="Mostrar/Ocultar Restaurantes">
                                <mat-icon>restaurant</mat-icon>
                            </button>
                            <button mat-icon-button 
                                    [class.active]="showHotels"
                                    (click)="toggleHotels()"
                                    matTooltip="Mostrar/Ocultar Hotéis">
                                <mat-icon>hotel</mat-icon>
                            </button>
                            <button mat-icon-button 
                                    [class.active]="showGasStations"
                                    (click)="toggleGasStations()"
                                    matTooltip="Mostrar/Ocultar Postos">
                                <mat-icon>local_gas_station</mat-icon>
                            </button>
                        </div>
                    </mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                    <div class="map-container" #mapContainer>
                        <!-- Mensagem de carregamento -->
                        <div class="map-placeholder" *ngIf="!mapInitialized">
                            <mat-icon>map</mat-icon>
                            <p>Carregando mapa...</p>
                            <small>Se o mapa não carregar, verifique se a API do Google Maps está configurada</small>
                        </div>
                    </div>

                    <!-- Informações da rota -->
                    <div class="rota-info" *ngIf="dados.dia.rota">
                        <div class="rota-item">
                            <mat-icon>my_location</mat-icon>
                            <span><strong>Origem:</strong> {{ dados.dia.origem }}</span>
                        </div>
                        <div class="rota-item">
                            <mat-icon>flag</mat-icon>
                            <span><strong>Destino:</strong> {{ dados.dia.destino }}</span>
                        </div>
                        <div class="rota-item" *ngIf="dados.dia.rota.tipoEstrada">
                            <mat-icon>road</mat-icon>
                            <span><strong>Tipo:</strong> {{ dados.dia.rota.tipoEstrada }}</span>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <!-- Estado de erro -->
    <div class="error-state" *ngIf="(isLoading$ | async) === false && !dados.dia">
        <mat-card>
            <mat-card-content>
                <div class="empty-content">
                    <mat-icon class="empty-icon error">error</mat-icon>
                    <h3>Dia não encontrado</h3>
                    <p>Não foi possível carregar os dados deste dia</p>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>