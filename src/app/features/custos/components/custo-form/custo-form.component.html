<mat-card class="custo-form-card">
    <mat-card-header>
        <mat-card-title>
            <mat-icon>attach_money</mat-icon>
            {{ isEditMode ? 'Editar Custo' : 'Novo Custo' }}
        </mat-card-title>
    </mat-card-header>

    <mat-card-content>
        <form [formGroup]="custoForm" (ngSubmit)="onSalvar()" class="custo-form">

            <!-- Categoria -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Categoria</mat-label>
                <mat-select formControlName="categoria" required>
                    <mat-option *ngFor="let categoria of categorias" [value]="categoria">
                        {{ categoriasLabels[categoria] }}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="temErro('categoria')">
                    {{ obterMensagemErro('categoria') }}
                </mat-error>
            </mat-form-field>

            <!-- Descrição -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Descrição</mat-label>
                <input matInput formControlName="descricao" placeholder="Ex: Almoço no restaurante" maxlength="200"
                    required>
                <mat-hint align="end">{{ custoForm.get('descricao')?.value?.length || 0 }}/200</mat-hint>
                <mat-error *ngIf="temErro('descricao')">
                    {{ obterMensagemErro('descricao') }}
                </mat-error>
            </mat-form-field>

            <!-- Valor -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Valor</mat-label>
                <input matInput formControlName="valor" (input)="onValorChange($event)" placeholder="0,00" required>
                <span matPrefix>R$&nbsp;</span>
                <mat-error *ngIf="temErro('valor')">
                    {{ obterMensagemErro('valor') }}
                </mat-error>
            </mat-form-field>

            <div class="form-row">
                <!-- Data -->
                <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Data</mat-label>
                    <input matInput [matDatepicker]="datePicker" formControlName="data" required>
                    <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
                    <mat-datepicker #datePicker></mat-datepicker>
                    <mat-error *ngIf="temErro('data')">
                        {{ obterMensagemErro('data') }}
                    </mat-error>
                </mat-form-field>

                <!-- Hora -->
                <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Hora (opcional)</mat-label>
                    <input matInput formControlName="hora" type="time">
                </mat-form-field>
            </div>

            <!-- Local -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Local (opcional)</mat-label>
                <input matInput formControlName="local" placeholder="Ex: Posto BR - Km 150" maxlength="100">
                <mat-hint align="end">{{ custoForm.get('local')?.value?.length || 0 }}/100</mat-hint>
            </mat-form-field>

            <div class="form-row">
                <!-- Método de Pagamento -->
                <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Método de Pagamento</mat-label>
                    <mat-select formControlName="metodoPagamento">
                        <mat-option value="">Selecione</mat-option>
                        <mat-option *ngFor="let metodo of metodosPagamento" [value]="metodo">
                            {{ metodosLabels[metodo] }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <!-- Dia da Viagem -->
                <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Dia da Viagem (opcional)</mat-label>
                    <mat-select formControlName="diaViagemId">
                        <mat-option value="">Não associar a um dia específico</mat-option>
                        <mat-option *ngFor="let dia of diasViagem$ | async" [value]="dia.id">
                            Dia {{ dia.ordem }} - {{ dia.cidadeOrigem }} → {{ dia.cidadeDestino }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <!-- Tipo de Custo -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Tipo de Custo</mat-label>
                <mat-select formControlName="tipo" required>
                    <mat-option value="planejado">Planejado</mat-option>
                    <mat-option value="real">Real</mat-option>
                </mat-select>
                <mat-hint>
                    Custos planejados são estimativas, custos reais são gastos efetivos
                </mat-hint>
            </mat-form-field>

            <!-- Observações -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Observações (opcional)</mat-label>
                <textarea matInput formControlName="observacoes" rows="3" maxlength="500"
                    placeholder="Informações adicionais sobre este custo"></textarea>
                <mat-hint align="end">{{ custoForm.get('observacoes')?.value?.length || 0 }}/500</mat-hint>
            </mat-form-field>

        </form>
    </mat-card-content>

    <mat-card-actions align="end">
        <button mat-button type="button" (click)="onCancelar()" [disabled]="isLoading">
            Cancelar
        </button>

        <button mat-raised-button color="primary" (click)="onSalvar()" [disabled]="custoForm.invalid || isLoading">
            <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
            <mat-icon *ngIf="!isLoading">save</mat-icon>
            {{ isLoading ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Salvar') }}
        </button>
    </mat-card-actions>
</mat-card>