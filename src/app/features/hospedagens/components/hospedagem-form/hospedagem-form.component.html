<mat-card class="hospedagem-form-card">
    <mat-card-header>
        <mat-card-title>
            <mat-icon>hotel</mat-icon>
            {{ isEditMode ? 'Editar Hospedagem' : 'Nova Hospedagem' }}
        </mat-card-title>
    </mat-card-header>

    <mat-card-content>
        <form [formGroup]="hospedagemForm" (ngSubmit)="onSubmit()" class="hospedagem-form">

            <!-- Informações Básicas -->
            <div class="form-section">
                <h3 class="section-title">Informações Básicas</h3>

                <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Nome do Estabelecimento</mat-label>
                        <input matInput formControlName="nome" placeholder="Ex: Hotel Central, Pousada do Vale">
                        <mat-icon matSuffix>business</mat-icon>
                        <mat-error *ngIf="hasError('nome')">
                            {{ getErrorMessage('nome') }}
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="form-row">
                    <mat-form-field appearance="outline" class="half-width">
                        <mat-label>Tipo de Hospedagem</mat-label>
                        <mat-select formControlName="tipo">
                            <mat-option *ngFor="let tipo of tiposHospedagem" [value]="tipo">
                                {{ getTipoHospedagemLabel(tipo) }}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="hasError('tipo')">
                            {{ getErrorMessage('tipo') }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="half-width">
                        <mat-label>Valor da Diária</mat-label>
                        <input matInput type="number" formControlName="valorDiaria" placeholder="0,00" min="0"
                            step="0.01">
                        <span matPrefix>R$&nbsp;</span>
                        <mat-error *ngIf="hasError('valorDiaria')">
                            {{ getErrorMessage('valorDiaria') }}
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Endereço Completo</mat-label>
                        <textarea matInput formControlName="endereco" rows="2"
                            placeholder="Rua, número, bairro, cidade - UF, CEP"></textarea>
                        <mat-icon matSuffix>location_on</mat-icon>
                        <mat-error *ngIf="hasError('endereco')">
                            {{ getErrorMessage('endereco') }}
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <!-- Datas e Horários -->
            <div class="form-section">
                <h3 class="section-title">Datas e Horários</h3>

                <div class="form-row">
                    <mat-form-field appearance="outline" class="half-width">
                        <mat-label>Data de Check-in</mat-label>
                        <input matInput [matDatepicker]="pickerCheckIn" formControlName="dataCheckIn">
                        <mat-datepicker-toggle matSuffix [for]="pickerCheckIn"></mat-datepicker-toggle>
                        <mat-datepicker #pickerCheckIn></mat-datepicker>
                        <mat-error *ngIf="hasError('dataCheckIn')">
                            {{ getErrorMessage('dataCheckIn') }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="half-width">
                        <mat-label>Data de Check-out</mat-label>
                        <input matInput [matDatepicker]="pickerCheckOut" formControlName="dataCheckOut">
                        <mat-datepicker-toggle matSuffix [for]="pickerCheckOut"></mat-datepicker-toggle>
                        <mat-datepicker #pickerCheckOut></mat-datepicker>
                        <mat-error *ngIf="hasError('dataCheckOut')">
                            {{ getErrorMessage('dataCheckOut') }}
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="form-row">
                    <mat-form-field appearance="outline" class="half-width">
                        <mat-label>Horário de Check-in</mat-label>
                        <input matInput type="time" formControlName="horaCheckIn">
                        <mat-icon matSuffix>schedule</mat-icon>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="half-width">
                        <mat-label>Horário de Check-out</mat-label>
                        <input matInput type="time" formControlName="horaCheckOut">
                        <mat-icon matSuffix>schedule</mat-icon>
                    </mat-form-field>
                </div>

                <!-- Resumo da Estadia -->
                <div class="estadia-resumo" *ngIf="numeroNoites > 0">
                    <mat-card class="resumo-card">
                        <mat-card-content>
                            <div class="resumo-info">
                                <div class="resumo-item">
                                    <span class="label">Número de noites:</span>
                                    <span class="value">{{ numeroNoites }}</span>
                                </div>
                                <div class="resumo-item">
                                    <span class="label">Valor da diária:</span>
                                    <span class="value">{{ hospedagemForm.get('valorDiaria')?.value |
                                        currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</span>
                                </div>
                                <div class="resumo-item total">
                                    <span class="label">Valor total:</span>
                                    <span class="value">{{ valorTotal | currency:'BRL':'symbol':'1.2-2':'pt-BR'
                                        }}</span>
                                </div>
                            </div>
                        </mat-card-content>
                    </mat-card>
                </div>
            </div>

            <!-- Informações Adicionais -->
            <div class="form-section">
                <h3 class="section-title">Informações Adicionais</h3>

                <div class="form-row">
                    <mat-checkbox formControlName="estacionamentoCoberto" class="estacionamento-checkbox">
                        <mat-icon>motorcycle</mat-icon>
                        Possui estacionamento coberto para motocicleta
                    </mat-checkbox>
                </div>

                <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Link da Reserva</mat-label>
                        <input matInput formControlName="linkReserva" placeholder="https://booking.com/...">
                        <mat-icon matSuffix>link</mat-icon>
                        <mat-error *ngIf="hasError('linkReserva')">
                            {{ getErrorMessage('linkReserva') }}
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="form-row">
                    <mat-form-field appearance="outline" class="half-width">
                        <mat-label>Telefone</mat-label>
                        <input matInput formControlName="telefone" placeholder="(11) 99999-9999">
                        <mat-icon matSuffix>phone</mat-icon>
                        <mat-error *ngIf="hasError('telefone')">
                            {{ getErrorMessage('telefone') }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="half-width">
                        <mat-label>Email</mat-label>
                        <input matInput type="email" formControlName="email" placeholder="contato@hotel.com">
                        <mat-icon matSuffix>email</mat-icon>
                        <mat-error *ngIf="hasError('email')">
                            {{ getErrorMessage('email') }}
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Site Oficial</mat-label>
                        <input matInput formControlName="siteOficial" placeholder="https://www.hotel.com">
                        <mat-icon matSuffix>language</mat-icon>
                        <mat-error *ngIf="hasError('siteOficial')">
                            {{ getErrorMessage('siteOficial') }}
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="form-row">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Observações</mat-label>
                        <textarea matInput formControlName="observacoes" rows="3"
                            placeholder="Informações adicionais sobre a hospedagem..."></textarea>
                        <mat-icon matSuffix>notes</mat-icon>
                    </mat-form-field>
                </div>
            </div>

            <!-- Sistema de Avaliação -->
            <div class="form-section">
                <h3 class="section-title">
                    <mat-icon>star</mat-icon>
                    Avaliação da Hospedagem
                </h3>

                <mat-expansion-panel class="avaliacao-panel">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Avaliação Geral:
                            <span class="avaliacao-valor">{{ avaliacaoGeral }}/5</span>
                            <div class="estrelas-display">
                                <mat-icon *ngFor="let estrela of getEstrelas(avaliacaoGeral)"
                                    [class.estrela-preenchida]="estrela === 1">
                                    star
                                </mat-icon>
                            </div>
                        </mat-panel-title>
                    </mat-expansion-panel-header>

                    <div class="avaliacao-content">
                        <!-- Avaliação Geral -->
                        <div class="avaliacao-item">
                            <label class="avaliacao-label">Avaliação Geral</label>
                            <mat-slider min="0" max="5" step="1" [value]="avaliacaoGeral"
                                (valueChange)="onAvaliacaoGeralChange($event)" class="avaliacao-slider">
                            </mat-slider>
                            <span class="avaliacao-numero">{{ avaliacaoGeral }}/5</span>
                        </div>

                        <!-- Avaliações Detalhadas -->
                        <div class="avaliacoes-detalhadas">
                            <h4>Avaliação Detalhada</h4>

                            <div *ngFor="let item of avaliacaoDetalhadaKeys" class="avaliacao-item">
                                <label class="avaliacao-label">{{ getAvaliacaoLabel(item) }}</label>
                                <mat-slider min="0" max="5" step="1" [value]="getAvaliacaoDetalhadaValue(item)"
                                    (valueChange)="onAvaliacaoDetalhadaChange(item, $event)" class="avaliacao-slider">
                                </mat-slider>
                                <span class="avaliacao-numero">{{ getAvaliacaoDetalhadaValue(item) }}/5</span>
                            </div>

                            <div class="media-avaliacao" *ngIf="getAvaliacaoMedia() > 0">
                                <strong>Média das avaliações: {{ getAvaliacaoMedia() | number:'1.1-1' }}/5</strong>
                            </div>
                        </div>
                    </div>
                </mat-expansion-panel>
            </div>

            <!-- Upload de Fotos -->
            <div class="form-section">
                <h3 class="section-title">
                    <mat-icon>photo_camera</mat-icon>
                    Fotos da Hospedagem
                </h3>

                <div class="upload-section">
                    <input type="file" accept="image/*" (change)="onFileSelected($event)" #fileInput
                        style="display: none;">

                    <button mat-raised-button color="accent" type="button" (click)="fileInput.click()"
                        [disabled]="uploadingFoto">
                        <mat-icon>{{ uploadingFoto ? 'hourglass_empty' : 'add_photo_alternate' }}</mat-icon>
                        {{ uploadingFoto ? 'Enviando...' : 'Adicionar Foto' }}
                    </button>

                    <p class="upload-info">
                        Formatos aceitos: JPG, PNG, GIF. Tamanho máximo: 5MB
                    </p>
                </div>

                <!-- Galeria de Fotos -->
                <div class="fotos-galeria" *ngIf="fotosHospedagem.length > 0">
                    <div class="foto-item" *ngFor="let foto of fotosHospedagem; let i = index">
                        <img [src]="foto" [alt]="'Foto ' + (i + 1)" class="foto-preview">
                        <button mat-icon-button color="warn" class="remover-foto" (click)="removerFoto(i)"
                            type="button">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </div>
                </div>
            </div>

        </form>
    </mat-card-content>

    <mat-card-actions align="end" class="form-actions">
        <button mat-button type="button" (click)="onCancelar()" [disabled]="isLoading">
            <mat-icon>cancel</mat-icon>
            Cancelar
        </button>

        <button mat-raised-button color="primary" type="submit" (click)="onSubmit()"
            [disabled]="hospedagemForm.invalid || isLoading">
            <mat-icon>{{ isLoading ? 'hourglass_empty' : 'save' }}</mat-icon>
            {{ isLoading ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Salvar') }}
        </button>
    </mat-card-actions>
</mat-card>